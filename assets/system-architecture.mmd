%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#dae8fc','primaryTextColor':'#000','primaryBorderColor':'#6c8ebf','lineColor':'#666','secondaryColor':'#fff2cc','tertiaryColor':'#d5e8d4'}}}%%

graph TB
    subgraph Developer["üë®‚Äçüíª DEVELOPER"]
        DEV[Git Push]
    end
    
    subgraph GitHub["üì¶ GITHUB REPOSITORIES"]
        GH1["üîß Infrastructure Repo<br/>‚Ä¢ K8s Manifests<br/>‚Ä¢ Database<br/>‚Ä¢ Ingress<br/>‚Ä¢ ArgoCD Configs<br/>‚Ä¢ Terraform IaC"]
        GH2["‚öõÔ∏è Frontend Repo<br/>(three-tier-fe)<br/>‚Ä¢ React Frontend<br/>‚Ä¢ Nginx Config<br/>‚Ä¢ K8s Manifests<br/>‚Ä¢ Jenkinsfile<br/>‚Ä¢ Dockerfile"]
        GH3["üü¢ Backend Repo<br/>(three-tier-be)<br/>‚Ä¢ Node.js Backend<br/>‚Ä¢ Express API<br/>‚Ä¢ K8s Manifests<br/>‚Ä¢ Jenkinsfile<br/>‚Ä¢ Dockerfile"]
    end
    
    subgraph Jenkins["üî® JENKINS CI/CD SERVER (EC2)"]
        J1["Frontend MBP<br/>‚Ä¢ SonarQube<br/>‚Ä¢ Trivy Scan<br/>‚Ä¢ Docker Build<br/>‚Ä¢ ECR Push"]
        J2["Backend MBP<br/>‚Ä¢ SonarQube<br/>‚Ä¢ Trivy Scan<br/>‚Ä¢ Docker Build<br/>‚Ä¢ ECR Push"]
        J3["Infrastructure<br/>‚Ä¢ Terraform<br/>‚Ä¢ Scripts<br/>‚Ä¢ Monitoring"]
    end
    
    subgraph ECR["üê≥ AWS ECR REGISTRY"]
        ECR1["Frontend Repository<br/>‚Ä¢ Tagged Images<br/>‚Ä¢ Lifecycle Policy<br/>(Delete untagged > 5 days)"]
        ECR2["Backend Repository<br/>‚Ä¢ Tagged Images<br/>‚Ä¢ Lifecycle Policy<br/>(Delete untagged > 5 days)"]
    end
    
    subgraph ArgoCD["üîÑ ARGOCD (GitOps)"]
        UPDATER["üì° Image Updater<br/>Monitors ECR for New Tags"]
        ARGO1["Frontend App<br/>‚Ä¢ Auto-sync: true<br/>‚Ä¢ Image Updater<br/>‚Ä¢ Tag regex: ^[0-9-]+$<br/>‚Ä¢ Direct cluster updates"]
        ARGO2["Backend App<br/>‚Ä¢ Auto-sync: true<br/>‚Ä¢ Image Updater<br/>‚Ä¢ Tag regex: ^[0-9-]+$<br/>‚Ä¢ Direct cluster updates"]
    end
    
    subgraph EKS["‚ò∏Ô∏è AWS EKS CLUSTER"]
        subgraph NS["Namespace: three-tier"]
            POD1["‚öõÔ∏è Frontend Pod(s)<br/>‚Ä¢ React App<br/>‚Ä¢ Nginx<br/>‚Ä¢ Port: 3000"]
            POD2["üü¢ Backend Pod(s)<br/>‚Ä¢ Node.js API<br/>‚Ä¢ Express<br/>‚Ä¢ Port: 3500"]
            POD3["üçÉ MongoDB Pod(s)<br/>‚Ä¢ Database<br/>‚Ä¢ Persistent Volume<br/>‚Ä¢ Port: 27017"]
            SVC["üîó Services<br/>‚Ä¢ frontend-svc (ClusterIP)<br/>‚Ä¢ backend-svc (ClusterIP)<br/>‚Ä¢ mongodb-svc (ClusterIP)"]
            ING["üåê Ingress<br/>AWS Load Balancer Controller<br/>‚Ä¢ ALB<br/>‚Ä¢ Path-based routing"]
        end
    end
    
    ALB["‚ö° AWS APPLICATION LOAD BALANCER<br/>http://&lt;alb-dns&gt; ‚Üí Frontend<br/>http://&lt;alb-dns&gt;/api ‚Üí Backend"]
    
    USERS["üë• END USERS"]
    
    subgraph Monitoring["üìä MONITORING & OBSERVABILITY"]
        PROM["üìà Prometheus<br/>‚Ä¢ Metrics Collection<br/>‚Ä¢ Service Discovery<br/>‚Ä¢ Alert Rules"]
        GRAF["üìâ Grafana<br/>‚Ä¢ Dashboards<br/>‚Ä¢ Visualizations<br/>‚Ä¢ Alerting"]
    end
    
    %% Connections - Developer to GitHub
    DEV -->|Push Code| GH1
    DEV -->|Push Code| GH2
    DEV -->|Push Code| GH3
    
    %% GitHub to Jenkins (Webhooks)
    GH1 -.->|Webhook| J3
    GH2 -.->|Webhook| J1
    GH3 -.->|Webhook| J2
    
    %% Jenkins to ECR
    J1 -->|Push Image<br/>YYYYMMDD-BUILD| ECR1
    J2 -->|Push Image<br/>YYYYMMDD-BUILD| ECR2
    
    %% ECR to ArgoCD
    ECR1 & ECR2 -->|Monitor Tags| UPDATER
    UPDATER --> ARGO1
    UPDATER --> ARGO2
    
    %% ArgoCD to EKS
    ARGO1 -->|Deploy| POD1
    ARGO2 -->|Deploy| POD2
    
    %% EKS Internal Connections
    POD1 --> SVC
    POD2 --> SVC
    POD3 <-->|DB Connection| POD2
    SVC --> ING
    
    %% EKS to ALB
    ING -->|Internet Traffic| ALB
    
    %% ALB to Users
    ALB -->|HTTP/HTTPS| USERS
    
    %% Monitoring Connections
    POD1 & POD2 & POD3 -.->|Scrape Metrics| PROM
    PROM --> GRAF
    
    %% Styling
    classDef githubStyle fill:#dae8fc,stroke:#6c8ebf,stroke-width:2px
    classDef jenkinsStyle fill:#fff2cc,stroke:#d6b656,stroke-width:2px
    classDef ecrStyle fill:#f8cecc,stroke:#b85450,stroke-width:2px
    classDef argoStyle fill:#d5e8d4,stroke:#82b366,stroke-width:2px
    classDef eksStyle fill:#e1d5e7,stroke:#9673a6,stroke-width:2px
    classDef podStyle fill:#cce5ff,stroke:#36393d,stroke-width:2px
    classDef monStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef albStyle fill:#ffccbc,stroke:#ff5722,stroke-width:2px
    classDef userStyle fill:#b0bec5,stroke:#455a64,stroke-width:2px
    
    class GH1,GH2,GH3 githubStyle
    class J1,J2,J3 jenkinsStyle
    class ECR1,ECR2 ecrStyle
    class UPDATER,ARGO1,ARGO2 argoStyle
    class POD1,POD2,POD3,SVC,ING podStyle
    class PROM,GRAF monStyle
    class ALB albStyle
    class USERS userStyle
